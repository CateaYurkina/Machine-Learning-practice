{"cells":[{"cell_type":"markdown","metadata":{"id":"-xTqJBDYjEc5"},"source":["## Домашнее задание №7\n","\n","##### Автор: [Радослав Нейчев](https://www.linkedin.com/in/radoslav-neychev/), @neychev"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"K50SsfkvjEc_"},"outputs":[],"source":["import numpy as np\n","\n","import torch\n","from torch import nn\n","from torch.nn import functional as F\n","\n","import torchvision\n","from torchvision.datasets import MNIST\n","\n","from matplotlib import pyplot as plt\n","from IPython.display import clear_output"]},{"cell_type":"markdown","metadata":{"id":"Bbg8sSSzjEdC"},"source":["### Задача №1:\n","Обратимся к классической задаче распознавания рукописных цифр. Мы будем работать с набором данных [MNIST](http://yann.lecun.com/exdb/mnist/). В данном задании воспользуемся всем датасетом целиком.\n","\n","__Ваша основная задача: реализовать весь пайплан обучения модели и добиться качества $\\geq 92\\%$ на тестовой выборке.__\n","\n","Код для обучения модели в данном задании отсутствует. Присутствует лишь несколько тестов, которые помогут вам отладить свое решение. За примером можно обратиться к ноутбуку первого занятия.\n","\n","Настоятельно рекомендуем написать код \"с нуля\", лишь поглядывая на готовые примеры, а не просто \"скопировать-вставить\". Это поможет вам в дальнейшем."]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":470},"id":"EMfsu-VpjEdE","executionInfo":{"status":"ok","timestamp":1753381746985,"user_tz":-180,"elapsed":433,"user":{"displayName":"Ekaterina Yurkina","userId":"00323084364712549389"}},"outputId":"6a3a69e6-6e3c-4496-a68f-fce626fce0a1"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["Text(0.5, 1.0, 'Image label: 3')"]},"metadata":{},"execution_count":55},{"output_type":"display_data","data":{"text/plain":["<Figure size 640x480 with 1 Axes>"],"image/png":"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/Rfi+++/V35+vmbMmKFp06b555880qrLjh07lJqaGtCjz+fzf2WWlpYmY4xSU1PVpUuXC+7Rqerqavl8vjqP3oCTOAeEJi88PPy0K8neeeed067wGjJkiL777jv95S9/8c+rqqrSH//4x4BxvXv3Vlpamn7729/WeZ7jH//4h+P+JJ3W4+zZs89Yc/IS9JNeffVVSVJmZqakE0cg4eHhmjFjxmnva4w54+XdJ53vZdjl5eV1jnnjjTckSdddd91Z63Fp4wgITd4dd9yh5557TmPHjtWNN96oLVu2aP78+erUqVPAuAcffFCvvfaa7rnnHj322GNKTEzU/Pnz1bx5c0n//JorLCxMb7zxhjIzM3X11Vdr7Nixat++vb777jutXr1aMTExeu+99867v5iYGPXr108zZ85UTU2N2rdvr48++ijgUvJTFRcXa+jQocrIyFBRUZHefvtt3Xvvvf6vu9LS0vSrX/1KOTk52r17t4YPH67o6GgVFxdryZIlGj9+vKZOnXrG98/JydFbb72l4uLis16IUFBQoEcffVT/8i//os6dO+vYsWP6r//6L7377ru67rrr9G//9m/nvR1w6SGA0OT94he/UGVlpRYsWKDFixfr2muv1V//+lc99dRTAeOioqK0atUqTZw4US+//LKioqJ0//3368Ybb9TIkSP9QSRJ/fv3V1FRkZ5//nm99tprOnz4sBISEpSenq4HH3zQcY8LFizQxIkTNWfOHBljNHjwYH3wwQdKSkqqc/zixYs1bdo0PfXUU4qIiNCECRP00ksvBYx56qmn1KVLF/3+97/XjBkzJEnJyckaPHhwwJV+F6JHjx4aMGCAli1bpv3798sYo7S0NE2bNk2PP/64IiMjQ7IeNE0uc+rxOYAAs2fP1uTJk/Xtt9+qffv2ttsBmgwCCPiBo0ePnvY7OT/60Y9UW1urr776ymJnQNPDV3DAD4wYMUIdO3ZUr169VFFRobffflvbtm3T/PnzbbcGNDkEEPADQ4YM0RtvvKH58+ertrZWV111lRYtWqS7777bdmtAk8NXcAAAK/g9IACAFQQQAMCKBncOyOfzad++fYqOjj7t/lYAgIbPGKNDhw4pKSnprI9kb3ABtG/fPiUnJ9tuAwBwgfbu3asOHTqccXmDC6Do6GhJ0s26XREK7S3jAQD177hq9LH+5v/3/EzqLYDm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Dhx42vicnBxNmTLF/9rr9RJCAHAJqPfLsDt16qQ2bdpo586ddS53u92KiYkJmAAATV+9B9C3336rsrIyJSYm1veqAACNiOOv4A4fPhxwNFNcXKxNmzYpLi5OcXFxmjFjhkaOHKmEhATt2rVLTzzxhK644goNGTIkpI0DABo3xwG0fv16DRgwwP/65PmbrKwszZ07V5s3b9Zbb72l8vJyJSUlafDgwXr++efldrtD1zUAoNFzHED9+/eXMeaMyz/88MMLagiwqdocd1yztcbluGbloe6Oa+6K2ei45mKKDfM5rkmJcH4d1HvjZzqumfDezxzXSJJv87ag6nB+uBccAMAKAggAYAUBBACwggACAFhBAAEArCCAAABWEEAAACsIIACAFQQQAMAKAggAYAUBBACwggACAFhBAAEArHCZs93a2gKv1yuPx6P+GqYIVzPb7aCRCu/cKag67zVtHde0+s91Qa2rqQm/qovjmm0PXea4ZsfIuY5rvqs94rhGksaNesR50drNQa2rKTlualSgZaqoqDjrU645AgIAWEEAAQCsIIAAAFYQQAAAKwggAIAVBBAAwAoCCABgBQEEALCCAAIAWEEAAQCsIIAAAFYQQAAAKyJsNwDUh9odXwdV1yrIOki1X37luKbb02e+UeWZ3HPtjx3XLExd4bhGknZOCHdcc8XaoFZ1SeIICABgBQEEALCCAAIAWEEAAQCsIIAAAFYQQAAAKwggAIAVBBAAwAoCCABgBQEEALCCAAIAWEEAAQCs4GakAKyp9Xod13z3crrzFc0O7makzSKPB1WH88MREADACgIIAGAFAQQAsIIAAgBYQQABAKwggAAAVhBAAAArCCAAgBUEEADACgIIAGAFAQQAsIIAAgBYwc1IATQqh9uH224BIcIREADACgIIAGCFowDKzc3V9ddfr+joaLVr107Dhw/X9u3bA8ZUVVUpOztbrVu3VlRUlEaOHKkDBw6EtGkAQOPnKIAKCwuVnZ2ttWvXasWKFaqpqdHgwYNVWVnpHzN58mS99957euedd1RYWKh9+/ZpxIgRIW8cANC4OboIYfny5QGv8/Ly1K5dO23YsEH9+vVTRUWF3nzzTS1YsEC33XabJGnevHm68sortXbtWt1www2h6xwA0Khd0DmgiooKSVJcXJwkacOGDaqpqdGgQYP8Y7p166aOHTuqqKio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3Gm7FWtO7gPsH6fr1KmT2rRp0yT3jwkTJuj999/X6tWrA54flpCQoGPHjqm8vDxgfFPdH860HeqSnp4uSQ1qf2jwARQZGanevXsrPz/fP8/n8yk/P199+/a12Jl9hw8f1q5du5SYmGi7FWtSU1OVkJAQsH94vV6tW7fukt8/vv32W5WVlTWp/cMYowkTJmjJkiVatWqVUlNTA5b37t1bzZo1C9gftm/frj179jSp/eFc26EumzZtkqSGtT/YvgrifCxatMi43W6Tl5dnvvzySzN+/HgTGxtrSkpKbLd2Uf385z83BQUFpri42Pz97383gwYNMm3atDEHDx603Vq9OnTokNm4caPZuHGjkWRmzZplNm7caL755htjjDG//vWvTWxsrFm2bJnZvHmzGTZsmElNTTVHjx613HlonW07HDp0yEydOtUUFRWZ4uJis3LlSnPttdeazp07m6qqKtuth8zDDz9sPB6PKSgoMPv37/dPR44c8Y956KGHTMeOHc2qVavM+vXrTd++fU3fvn0tdh1659oOO3fuNM8995xZv369KS4uNsuWLTOdOnUy/fr1s9x5oEYRQMYY8+qrr5qOHTuayMhI06dPH7N27VrbLV10d999t0lMTDSRkZGmffv25u677zY7d+603Va9W716tZF02pSVlWWMOXEp9jPPPGPi4+ON2+02AwcONNu3b7fbdD0423Y4cuSIGTx4sGnbtq1p1qyZSUlJMePGjWty/0mr6/NLMvPmzfOPOXr0qHnkkUfMZZddZlq2bGnuuusus3//fntN14NzbYc9e/aYfv36mbi4OON2u80VV1xhHn/8cVNRUWG38VPwPCAAgBUN/hwQAKBpIoAAAFYQQAAAKwggAIAVBBAAwAoCCABgBQEEALCCAAIAWEEAAQCsIIAAAFYQQAAAK/4/zrOgzAkUvp0AAAAASUVORK5CYII=\n"},"metadata":{}}],"source":["# do not change the code in the block below\n","# __________start of block__________\n","\n","train_mnist_data = MNIST('.', train=True, transform=torchvision.transforms.ToTensor(), download=True)\n","test_mnist_data = MNIST('.', train=False, transform=torchvision.transforms.ToTensor(), download=True)\n","\n","\n","train_data_loader = torch.utils.data.DataLoader(\n","    train_mnist_data,\n","    batch_size=32,\n","    shuffle=True,\n","    num_workers=2\n",")\n","\n","test_data_loader = torch.utils.data.DataLoader(\n","    test_mnist_data,\n","    batch_size=32,\n","    shuffle=False,\n","    num_workers=2\n",")\n","\n","random_batch = next(iter(train_data_loader))\n","_image, _label = random_batch[0][0], random_batch[1][0]\n","plt.figure()\n","plt.imshow(_image.reshape(28, 28))\n","plt.title(f'Image label: {_label}')\n","# __________end of block__________"]},{"cell_type":"markdown","metadata":{"id":"wcu94SoJjEdF"},"source":["Постройте модель ниже. Пожалуйста, не стройте переусложненную сеть, не стоит делать ее глубже четырех слоев (можно и меньше). Ваша основная задача – обучить модель и получить качество на отложенной (тестовой выборке) не менее 92% accuracy.\n","\n","*Комментарий: для этого достаточно линейных слоев и функций активации.*\n","\n","__Внимание, ваша модель должна быть представлена именно переменной `model`.__"]},{"cell_type":"code","source":["class MyNM:\n","  def __init__(self, X=[]):\n","      pass\n","  def fit(self, X, y):\n","    self.X_train = X\n","    self.y_train = y\n","  def predict(self, X):\n","    return self.y_predict"],"metadata":{"id":"683Bg3lqoyuX"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# def MyNM(X):\n","\n","#   y_predict = []\n","#   return y_predict"],"metadata":{"id":"4XZ-hnGdpPqQ"},"execution_count":null,"outputs":[]},{"cell_type":"code","execution_count":null,"metadata":{"id":"BVSuuCDNjEdG"},"outputs":[],"source":["# Creating model instance\n","model = nn.Sequential(\n","    nn.Linear(784, 128),   # Первый слой: вход 784 (например, изображение 28x28), 128 нейронов\n","    nn.ReLU(),             # Функция активации\n","    nn.Linear(128, 64),    # Второй слой\n","    nn.ReLU(),\n","    nn.Linear(64, 10)       # Выходной слой: 10 классов (например, для классификации MNIST)\n",")\n"]},{"cell_type":"markdown","metadata":{"id":"CGm5ZAu7jEdH"},"source":["Локальные тесты для проверки вашей модели доступны ниже:"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"48Oytw9PjEdI","executionInfo":{"status":"ok","timestamp":1753382054519,"user_tz":-180,"elapsed":27,"user":{"displayName":"Ekaterina Yurkina","userId":"00323084364712549389"}},"outputId":"c9e1740e-4815-47fb-a3e0-f16c786b3875"},"outputs":[{"output_type":"stream","name":"stdout","text":["Everything seems fine!\n"]}],"source":["# do not change the code in the block below\n","# __________start of block__________\n","assert model is not None, 'Please, use `model` variable to store your model'\n","\n","try:\n","    x = random_batch[0].reshape(-1, 784)\n","    y = random_batch[1]\n","\n","    # compute outputs given inputs, both are variables\n","    y_predicted = model(x)\n","except Exception as e:\n","    print('Something is wrong with the model')\n","    raise e\n","\n","\n","assert y_predicted.shape[-1] == 10, 'Model should predict 10 logits/probas'\n","\n","print('Everything seems fine!')\n","# __________end of block__________"]},{"cell_type":"markdown","metadata":{"id":"bQoEV_rujEdJ"},"source":["Настройте параметры модели на обучающей выборке. Рекомендуем поработать с различными оптимизаторами."]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"2ERJPhJcjEdL","executionInfo":{"status":"ok","timestamp":1753382615450,"user_tz":-180,"elapsed":288476,"user":{"displayName":"Ekaterina Yurkina","userId":"00323084364712549389"}},"outputId":"f07ada88-d009-4fe8-ee05-f6a60c6ec557"},"outputs":[{"output_type":"stream","name":"stdout","text":["Epoch 1/10, Loss: 0.0057797920890152454\n","Epoch 2/10, Loss: 0.0015934432158246636\n","Epoch 3/10, Loss: 0.023740272969007492\n","Epoch 4/10, Loss: 0.028947943821549416\n","Epoch 5/10, Loss: 0.0008389977738261223\n","Epoch 6/10, Loss: 0.002020246582105756\n","Epoch 7/10, Loss: 5.5312302720267326e-05\n","Epoch 8/10, Loss: 1.821338082663715e-05\n","Epoch 9/10, Loss: 0.001663340488448739\n","Epoch 10/10, Loss: 0.0001723827444948256\n","Epoch 1/10, Loss: 0.0008458555093966424\n","Epoch 2/10, Loss: 0.00021183464559726417\n","Epoch 3/10, Loss: 0.0006421744474209845\n","Epoch 4/10, Loss: 7.986468699527904e-05\n","Epoch 5/10, Loss: 0.0007195892976596951\n","Epoch 6/10, Loss: 3.556915544322692e-05\n","Epoch 7/10, Loss: 0.0005106203025206923\n","Epoch 8/10, Loss: 0.0009274351177737117\n","Epoch 9/10, Loss: 0.0010838204761967063\n","Epoch 10/10, Loss: 6.342568667605519e-05\n"]}],"source":["import torch.optim as optim\n","\n","# Выберите оптимизатор. Например:\n","optimizer = optim.SGD(model.parameters(), lr=0.01, momentum=0.9)\n","# Или попробуйте другой:\n","# optimizer = optim.Adam(model.parameters(), lr=0.001)\n","\n","# Выберите функцию потерь\n","criterion = nn.CrossEntropyLoss()\n","\n","# Обучающий цикл (пример)\n","num_epochs = 10\n","for epoch in range(num_epochs):\n","    for batch in train_data_loader:  # предполагается, что у вас есть DataLoader train_loader\n","        inputs, labels = batch\n","        # Обнуляем градиенты\n","        optimizer.zero_grad()\n","        # Проверка и подготовка данных\n","        inputs = inputs.reshape(-1, 784).float()\n","        # Прямой проход\n","        outputs = model(inputs)\n","        # Вычисляем потерю\n","        loss = criterion(outputs, labels)\n","        # Обратное распространение ошибки и обновление параметров\n","        loss.backward()\n","        optimizer.step()\n","\n","    print(f\"Epoch {epoch+1}/{num_epochs}, Loss: {loss.item()}\")\n","# Выберите оптимизатор. Например:\n","optimizer = optim.SGD(model.parameters(), lr=0.01, momentum=0.9)\n","# Или попробуйте другой:\n","# optimizer = optim.Adam(model.parameters(), lr=0.001)\n","\n","# Выберите функцию потерь\n","criterion = nn.CrossEntropyLoss()\n","\n","# Обучающий цикл (пример)\n","num_epochs = 10\n","for epoch in range(num_epochs):\n","    for batch in train_data_loader:  # предполагается, что у вас есть DataLoader train_loader\n","        inputs, labels = batch\n","        # Обнуляем градиенты\n","        optimizer.zero_grad()\n","        # Проверка и подготовка данных\n","        inputs = inputs.reshape(-1, 784).float()\n","        # Прямой проход\n","        outputs = model(inputs)\n","        # Вычисляем потерю\n","        loss = criterion(outputs, labels)\n","        # Обратное распространение ошибки и обновление параметров\n","        loss.backward()\n","        optimizer.step()\n","\n","    print(f\"Epoch {epoch+1}/{num_epochs}, Loss: {loss.item()}\")"]},{"cell_type":"markdown","metadata":{"id":"tDkabBHQjEdM"},"source":["Также, напоминаем, что в любой момент можно обратиться к замечательной [документации](https://pytorch.org/docs/stable/index.html) и [обучающим примерам](https://pytorch.org/tutorials/).  "]},{"cell_type":"markdown","metadata":{"id":"Ji4q77WwjEdN"},"source":["Оценим качество классификации:"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"e4UJ0X4IjEdO"},"outputs":[],"source":["predicted_labels = []\n","real_labels = []\n","model.eval()\n","with torch.no_grad():\n","    for batch in train_data_loader:\n","        y_predicted = model(batch[0].reshape(-1, 784))\n","        predicted_labels.append(y_predicted.argmax(dim=1))\n","        real_labels.append(batch[1])\n","\n","predicted_labels = torch.cat(predicted_labels)\n","real_labels = torch.cat(real_labels)\n","train_acc = (predicted_labels == real_labels).type(torch.FloatTensor).mean()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"lR8DRhDnjEdO","executionInfo":{"status":"ok","timestamp":1753382661041,"user_tz":-180,"elapsed":46,"user":{"displayName":"Ekaterina Yurkina","userId":"00323084364712549389"}},"outputId":"b8314c98-756a-43ed-932f-5884460dc0a5"},"outputs":[{"output_type":"stream","name":"stdout","text":["Neural network accuracy on train set: 1.0\n"]}],"source":["print(f'Neural network accuracy on train set: {train_acc:3.5}')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"6t2x4B4NjEdP"},"outputs":[],"source":["predicted_labels = []\n","real_labels = []\n","model.eval()\n","with torch.no_grad():\n","    for batch in test_data_loader:\n","        y_predicted = model(batch[0].reshape(-1, 784))\n","        predicted_labels.append(y_predicted.argmax(dim=1))\n","        real_labels.append(batch[1])\n","\n","predicted_labels = torch.cat(predicted_labels)\n","real_labels = torch.cat(real_labels)\n","test_acc = (predicted_labels == real_labels).type(torch.FloatTensor).mean()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"LpLujmE_jEdQ","executionInfo":{"status":"ok","timestamp":1753382677259,"user_tz":-180,"elapsed":27,"user":{"displayName":"Ekaterina Yurkina","userId":"00323084364712549389"}},"outputId":"212d53b4-1b42-4df7-f8e4-38baf9c7ab30"},"outputs":[{"output_type":"stream","name":"stdout","text":["Neural network accuracy on test set: 0.9824\n"]}],"source":["print(f'Neural network accuracy on test set: {test_acc:3.5}')"]},{"cell_type":"markdown","metadata":{"id":"PyQe2IK5jEdQ"},"source":["Проверка, что необходимые пороги пройдены:"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"oniSrEFLjEdR"},"outputs":[],"source":["assert test_acc >= 0.92, 'Test accuracy is below 0.92 threshold'\n","assert train_acc >= 0.91, 'Train accuracy is below 0.91 while test accuracy is fine. We recommend to check your model and data flow'"]},{"cell_type":"markdown","metadata":{"id":"G5E055mUjEdS"},"source":["### Сдача задания\n","Загрузите файл `hw07_data_dict.npy` (ссылка есть на странице с заданием) и запустите код ниже для генерации посылки. Код ниже может его загрузить (но в случае возникновения ошибки скачайте и загрузите его вручную)."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"SppU34NtjEdS"},"outputs":[],"source":["!wget https://raw.githubusercontent.com/girafe-ai/ml-course/23s_dd_ml/homeworks/hw07_mnist_classification/hw07_data_dict.npy"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"NMkTsNhajEdS"},"outputs":[],"source":["# do not change the code in the block below\n","# __________start of block__________\n","import os\n","\n","assert os.path.exists('hw07_data_dict.npy'), 'Please, download `hw07_data_dict.npy` and place it in the working directory'\n","\n","def get_predictions(model, eval_data, step=10):\n","\n","    predicted_labels = []\n","    model.eval()\n","    with torch.no_grad():\n","        for idx in range(0, len(eval_data), step):\n","            y_predicted = model(eval_data[idx:idx+step].reshape(-1, 784))\n","            predicted_labels.append(y_predicted.argmax(dim=1))\n","\n","    predicted_labels = torch.cat(predicted_labels)\n","    return predicted_labels\n","\n","loaded_data_dict = np.load('hw07_data_dict.npy', allow_pickle=True)\n","\n","submission_dict = {\n","    'train': get_predictions(model, torch.FloatTensor(loaded_data_dict.item()['train'])).numpy(),\n","    'test': get_predictions(model, torch.FloatTensor(loaded_data_dict.item()['test'])).numpy()\n","}\n","\n","np.save('submission_dict_hw07.npy', submission_dict, allow_pickle=True)\n","print('File saved to `submission_dict_hw07.npy`')\n","# __________end of block__________"]},{"cell_type":"markdown","metadata":{"id":"S9wa1qwJjEdT"},"source":["На этом задание завершено. Поздравляем!"]}],"metadata":{"kernelspec":{"display_name":"Py3 Research","language":"python","name":"py3_research"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.7.10"},"colab":{"provenance":[{"file_id":"15nAuVVnFBpCkBOdjS7ITlMbW5efYLpPu","timestamp":1753382814209}]}},"nbformat":4,"nbformat_minor":0}